<project name="processTranslatedFiles" default="processTranslation" basedir=".">
	
	<taskdef resource="net/sf/antcontrib/antlib.xml">
        <classpath>
            <fileset dir="${basedir}/ant.lib/ant-contrib"/>
        </classpath>
    </taskdef>  

	<!-- Get package URL -->
    <target name="getPkgURL" unless="pkg.url">
        <input message="Enter pkg.url"   addproperty="pkg.url" />
		<echo message="pkg.url # is [${pkg.url}]"/>        
    </target>
    <target name="getGSAuser" unless="gsa.userid">
        <input message="Enter GSA userid"   addproperty="gsa.userid" />
		<echo message="GSA userid # is [${gsa.userid}]"/>        
    </target>
	
	<!-- Get the GSA password -->
	<target name="getGSApassword" unless="gsa.password">
        <input message="Enter GSA password" addproperty="gsa.password">
		<echo message="GSA password # is [${gsa.password}]"/>  
       </input>
    </target>	
	<!-- Get the Github user ID -->
    <target name="getGithubUser" unless="github.userid">
        <input message="Enter github.userid"   addproperty="github.userid" />
		<echo message="github.userid # is [${github.userid}]"/>        
    </target>
	
	<!-- Get the Github password -->
	<target name="getGithubPassword" unless="github.password">
        <input message="Enter github.password" addproperty="github.password">
       </input>
	   <echo message="github.password # is [${github.password}]"/>  
    </target>
	
    <!-- Get the Shipment Number # -->
    <target name="getShipmentNumber" unless="shipmentNumber">                                                                         
        <input
            message="Enter the shipment number:"
            addproperty="shipmentNumber" />
        <echo message="shipmentNumber is [${shipmentNumber}]"/>        
    </target>  
	
	<!-- Get the plugin directory -->
    <target name="getLocalPluginDir" unless="localPluginDir">                                                                         
        <input
            message="Enter the plugin directory:"
            addproperty="localPluginDir"/>
        <echo message="Plugin directory is [${localPluginDir}]"/>        
    </target> 
	<!-- Get the short plugin name -->
    <target name="getPluginNameShort" unless="PluginNameShort">                                                                         
        <input
            message="Enter the plugin short name:"
            addproperty="PluginNameShort"/>
        <echo message="Plugin directory is [${PluginNameShort}]"/>        
    </target>
	<!-- Get the install directory -->
    <target name="getInstallDir" unless="installDir">                                                                         
        <input
            message="Enter the installation directory:"
            addproperty="installDir"/>
        <echo message="Installation directory is [${installDir}]"/>        
    </target>  
		<!-- Get the log file directory -->
    <target name="getLogFileLocation" unless="logFileLocation">                                                                         
        <input
            message="Enter the log file directory:"
            addproperty="logFileLocation"/>
        <echo message="Log directory is [${logFileLocation}]"/>        
    </target> 
	
    <!-- Get the check in comment -->
    <target name="getCheckInComment" unless="checkInComment">                                                                         
        <input
            message="Enter the comment to include while checking in the files:"
            addproperty="checkInComment"
        />
        <echo message="Check in comment is [${checkInComment}]"/>        
    </target>  
	
    <!-- Get the language -->
    <target name="getLang" unless="lang">
        <!-- for Chinese hans==zh/CN, hant==zh/TW -->                                                                                      
        <input
            message="Enter language to process as one of: de, es, fr, it, ja, ko, pt/BR, zh/CN, zh/TW, for Chinese hans==zh/CN, hant==zh/TW"
            addproperty="lang"
        />
        <echo message="lang is [${lang}]"/>
        <condition property="lang.matches">
            <matches pattern="de|es|fr|ja|it|ko|pt/BR|zh/CN|zh/TW" string="${lang}" casesensitive="true"/>
        </condition>
        <fail message="lang value [${lang}] is not one of: de, es, fr, it, ja, ko, pt/BR, zh/CN,zh/TW" unless="lang.matches"/>
    </target>
	
	<!-- Get subdirectory name if the variable is specified in the process_translations.bat file -->
	<target name="getSubdirectory1" if="subdirectory1">                                                                         
        <input
            message="Enter the subdirectory to include:"
            addproperty="subdirectory1"/>
        <echo message="The first subdirectory to include is [${subdirectory1}]"/>    		
    </target>  
	
	<!-- Get subdirectory name if the variable is specified in the process_translations.bat file -->
	<target name="getSubdirectory2" if="subdirectory2">                                                                         
        <input
            message="Enter the subdirectory to include:"
            addproperty="subdirectory2" />
        <echo message="The first subdirectory to include is [${subdirectory2}]"/>        
    </target> 
	
	<!-- Get subdirectory name if the variable is specified in the process_translations.bat file -->
	<target name="getSubdirectory3" if="subdirectory3">                                                                         
        <input
            message="Enter the subdirectory to include:"
            addproperty="subdirectory3"/>
        <echo message="The first subdirectory to include is [${subdirectory3}]"/>  
	</target> 
	
	<!-- Get subdirectory name if the variable is specified in the process_translations.bat file -->
	<target name="getSubdirectory4" if="subdirectory4">                                                                         
        <input
            message="Enter the subdirectory to include:"
            addproperty="subdirectory4" />
        <echo message="The first subdirectory to include is [${subdirectory4}]"/>        
    </target> 		
    
	<!-- Get subdirectory name if the variable is specified in the process_translations.bat file -->
	<target name="getSubdirectory5" if="subdirectory5">                                                                         
        <input
            message="Enter the subdirectory to include:"
            addproperty="subdirectory5" />
        <echo message="The first subdirectory to include is [${subdirectory5}]"/>        
    </target> 
    
 	<!-- Download the package from GSA and save it in a directory called translated --> 
    <target name="downloadTranslatedPackageFromUrl">
		<echo message="Start downloading translated package....." />
        <echo message="Lang   ${lang}" />	
		<echo message="localPluginDir   ${installDir}/${PluginNameShort}" />	
		<mkdir dir="${installDir}/${PluginNameShort}/nl/${lang}/translated"/>
            <property name="langToMatch"  value="${lang}"/>
            <get dest="${installDir}/${PluginNameShort}/nl/${lang}/translated/package.tpkg" username="${gsa.userid}" password="${gsa.password}" verbose="true">
                <url url="${pkg.url}"/>
             </get>
			 <rename src="${installDir}/${PluginNameShort}/nl/${lang}/translated/package.tpkg" dest="${installDir}/${PluginNameShort}/nl/${lang}/translated/package.pkg"/>
		<echo message="Package URL   ${pkg.url}" />
	</target>
	
 	<!-- Extract the downloaded package --> 	
    <target name="unpack_package" >
        <echo message="${lang}"/>             		
        <unzip src="${installDir}/${PluginNameShort}/nl/${lang}/translated/package.pkg" dest="${installDir}/${PluginNameShort}/nl/${lang}/translated/package"/>
        <echo message="Unzipping translated files into ${installDir}/${PluginNameShort}/nl/${lang}/translated/package"/>
        <unzip dest="${installDir}/${PluginNameShort}/nl/${lang}">
            <patternset>
                <include name="*.md"/>
                <include name="images/*.*"/>
				<include name="${subdirectory1}/*.md"/>
                <include name="${subdirectory1}/images/*.*"/>
				<include name="${subdirectory2}/*.md"/>
                <include name="${subdirectory2}/images/*.*"/>
				<include name="${subdirectory3}/*.md"/>
                <include name="${subdirectory3}/images/*.*"/>
				<include name="${subdirectory4}/*.md"/>
                <include name="${subdirectory4}/images/*.*"/>
				<include name="${subdirectory5}/*.md"/>
                <include name="${subdirectory5}/images/*.*"/>
            </patternset>
            <fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/translated">
                <include name="**/*.zip"/>
            </fileset>
        </unzip>    
		<if>
		  <available file="${installDir}/${PluginNameShort}/nl/${lang}/translated/package/${PluginNameShort}" type="dir" />
		  <then>
			<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/" overwrite="true">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/translated/package/${PluginNameShort}/"/>
			</copy>
		  </then>
		  <else>
			<echo message="Extra services directory does not exist. Good!" />
			<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/" overwrite="true">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/translated/package/"/>
			</copy>
		  </else>
		</if>		
	</target>

	
 	<!-- Copy the subdirectory package to its rightful place --> 		
	<target name="rearrange_directories1" if="subdirectory1">
		<echo message="Copying the ${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory1} directory to ${installDir}/${PluginNameShort}/${subdirectory1}/nl/${lang}"/>
		<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory1}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${PluginNameShort}/${subdirectory1}"/>
			</copy>
		<copy todir="${PluginNameShort}/${subdirectory1}/nl/${lang}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory1}"/>
		</copy>
	</target>
	
	<!-- Copy the subdirectory package to its rightful place --> 		
	<target name="rearrange_directories2" if="subdirectory2">
		<echo message="Copying the ${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory2} directory to ${installDir}/${PluginNameShort}/${subdirectory2}/nl/${lang}"/>
		<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory2}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${PluginNameShort}/${subdirectory2}"/>
			</copy>
		<copy todir="${installDir}/${PluginNameShort}/${subdirectory2}/nl/${lang}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory2}"/>
		</copy>
	</target>

	<!-- Copy the subdirectory package to its rightful place --> 		
	<target name="rearrange_directories3" if="subdirectory3">
		<echo message="Copying the ${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory3} directory to ${installDir}/${PluginNameShort}/${subdirectory3}/nl/${lang}"/>
		<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory3}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${PluginNameShort}/${subdirectory3}"/>
			</copy>
		<copy todir="${installDir}/${PluginNameShort}/${subdirectory3}/nl/${lang}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory3}"/>
		</copy>
	</target> 	
	
	<!-- Copy the subdirectory package to its rightful place --> 		
	<target name="rearrange_directories4" if="subdirectory4">
		<echo message="Copying the ${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory4} directory to ${installDir}/${PluginNameShort}/${subdirectory4}/nl/${lang}"/>
		<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory4}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${PluginNameShort}/${subdirectory4}"/>
			</copy>
		<copy todir="${installDir}/${PluginNameShort}/${subdirectory4}/nl/${lang}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory4}"/>
		</copy>
	</target>
	
	<!-- Copy the subdirectory package to its rightful place --> 	
	<target name="rearrange_directories5" if="subdirectory5">
		<echo message="Copying the ${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory5} directory to ${installDir}/${PluginNameShort}/${subdirectory5}/nl/${lang}"/>
		<copy todir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory5}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${PluginNameShort}/${subdirectory5}"/>
			</copy>
		<copy todir="${installDir}/${PluginNameShort}/${subdirectory5}/nl/${lang}">
			<fileset dir="${installDir}/${PluginNameShort}/nl/${lang}/${subdirectory5}"/>
		</copy>
	</target>

	<!-- Delete the translated directory where the package was downloaded --> 	
	<target name="delete_local_directories" >
        <delete dir="${installDir}/${PluginNameShort}/nl/${lang}/translated"/>
			<!-- Will have to add each major directory here: services, mobile, whatever -->
		<delete dir="${installDir}//${PluginNameShort}/nl/${lang}/services"/>
		<delete file="${installDir}/${PluginNameShort}/nl/${lang}/.pkgInfo.tpt"/>
	</target>

	<!-- ######################################################## DEFAULT TARGET ######################################################################### -->
   <target name="processTranslation" depends="getGSAuser, getGSApassword, getPkgURL, getGithubUser, getGithubPassword, getLang, getInstallDir, getLogFileLocation, getShipmentNumber, getLocalPluginDir, getPluginNameShort, getCheckInComment" unless="getSubdirectory1, getSubdirectory2, getSubdirectory3, getSubdirectory4, getSubdirectory5">  
  
          
		   
	       <echo message="*****************************************" />
	       <echo message="Language: ${lang}"/>
           <echo message="Directory: ${installDir}/${PluginNameShort}" />	
		   <echo message="Shipment Number: ${shipmentNumber}" />
		   <echo message="Check in comment: ${checkInComment}" />
		   <echo message="*****************************************" />
         
		   <antcall target="downloadTranslatedPackageFromUrl" /> 
		   <antcall target="unpack_package" />	   
		   <antcall target="rearrange_directories1" />
		   <antcall target="rearrange_directories2" />
		   <antcall target="rearrange_directories3" />
		   <antcall target="rearrange_directories4" />
		   <antcall target="rearrange_directories5" />
		   <antcall target="delete_local_directories" />
		   
	 
    </target>    
</project>
